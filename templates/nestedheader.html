{% extends "base.html" %}
{% block title %}<title>{{ cur.0.module_name }}-消防系统计算平台</title>{% endblock %}
{% block extrastyle %}
    {% load staticfiles %}
    <link rel="stylesheet" href="https://bossanova.uk/jsuites/v2/jsuites.css" type="text/css"/>
    <link rel="stylesheet" href="{% static 'css/jexcel.css' %}" type="text/css"/>
    <script src="{% static 'js/jexcel.js' %}"></script>
    <script src="https://bossanova.uk/jsuites/v2/jsuites.js"></script>
{% endblock %}

{% block header %}
    {% include 'header.html' %}
    {% include 'select_module.html' %}
{% endblock %}

{% block content %}
    <div class="table">
        <h3 style="margin-top: 10px">消防系统用水量</h3>
        <div id="spreadsheet"></div>
        <div>
            <input type='button' class="btn-primary" value='新增' onclick=""/>
            <input type='button' class="btn-primary" value='保存' onclick=""/>
        </div>
    </div>
{% endblock %}


<script>
    //公式计算
    var data = [
        ['室外消火栓系统', '建筑类别1', 15, 20, 0.5, true, '=D1*E1*3600/1000', false, '这里是选择依据'],
        ['室内消火栓系统', '建筑类别2', 10, 15, 0.5, false, '=D2*E2*3600/1000', true, '填写选择依据'],
        ['合计', '', , '=SUM(D1:D2)', , , '=SUM(G1:G2)', '',],
        ['最大值', '', , '=MAX(D1:D2)', , , '=MAX(G1:G2)', '',],
    ];

    table = jexcel(document.getElementById('spreadsheet'), {
        data: data,
        columns: [
            {type: 'text', title: '系统名称', width: '100'},
            {type: 'text', title: '建筑类别', width: '100'},
            {type: 'text', title: '最小设计流量(L/s)', width: '100'},
            {type: 'text', title: '设计流量(L/s)', width: '100'},
            {type: 'text', title: '灭火持续时间(h)', width: '100'},
            {type: 'checkbox', title: '是否计入一次灭火设计流量', width: '200'},
            {type: 'text', title: '用水量(m³)', width: '100'},
            {type: 'checkbox', title: '是否计入消防水池容积', width: '180'},
            {type: 'text', title: '备注', width: '100'},
        ],
        nestedHeaders: [
            [
                {title: '', colspan: '1'},
                {title: '', colspan: '1'},
                {title: '', colspan: '1'},
                {title: '', colspan: '1'},
                {title: '', colspan: '1'},
                {title: '', colspan: '1'},
                {title: 'q(B)*t(B)*3600/1000', colspan: '1', alt: 'q(B)*t(B)*3600/1000'},
                {title: '', colspan: '1'},
                {title: '', colspan: '1'},
            ],
            [
                {title: '', colspan: '1'},
                {title: '', colspan: '1'},
                {title: '', colspan: '1'},
                {title: 'q(B)', colspan: '1'},
                {title: 't(B)', colspan: '1'},
                {title: '', colspan: '1'},
                {title: 'V(B)', colspan: '1'},
                {title: '', colspan: '1'},
                {title: '', colspan: '1'}
            ],
        ],
        wordWrap: true,
        allowComments: true,
        contextMenu: function (obj, x, y, e) {
            var items = [];
            if (y == null) {
                // Sorting
                if (obj.options.columnSorting == true) {
                    // Line
                    //items.push({ type:'line' });

                    items.push({
                        title: obj.options.text.orderAscending,
                        onclick: function () {
                            obj.orderBy(x, 0);
                        }
                    });
                    items.push({
                        title: obj.options.text.orderDescending,
                        onclick: function () {
                            obj.orderBy(x, 1);
                        }
                    });
                }
            } else {
                // Insert new row
                if (obj.options.allowInsertRow == true) {
                    items.push({
                        title: obj.options.text.insertANewRowAfter,
                        onclick: function () {
                            obj.insertRow(1, parseInt(y));
                        }
                    });
                }

                if (obj.options.allowDeleteRow == true) {
                    items.push({
                        title: obj.options.text.deleteSelectedRows,
                        onclick: function () {
                            obj.deleteRow(obj.getSelectedRows().length ? undefined : parseInt(y));
                        }
                    });
                }

                /*if (x) {
                 if (obj.options.allowComments == true) {
                 items.push({ type:'line' });

                 var title = obj.records[y][x].getAttribute('title') || '';

                 items.push({
                 title: title ? obj.options.text.editComments : obj.options.text.addComments,
                 onclick:function() {
                 obj.setComments([ x, y ], prompt(obj.options.text.comments, title));
                 }
                 });
                 }
                 }*/
            }
            return items;
        },
        text: {
            insertANewRowAfter: "插入一行",
            deleteSelectedRows: "删除选中行",
            orderAscending: "升序排列",
            orderDescending: "降序排列"
        }
    });
</script>